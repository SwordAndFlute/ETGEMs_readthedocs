<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5. Simulating with FBA &mdash; ETGEMs v1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5cb08e4e"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6. Bottleneck Reactions" href="../6.Bottleneck_reactions/index.html" />
    <link rel="prev" title="4. Reading, Correcting, and Writing Models." href="../4.Reading_correcting_and_write_model/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ETGEMs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../1.Getting_started/index.html">1. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.Global_configuration/index.html">2. Global Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3.Building_a_model/index.html">3. Build a Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4.Reading_correcting_and_write_model/index.html">4. Reading, Correcting, and Writing Models.</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. Simulating with FBA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#flux-balance-analysis-fba">5.1. Flux balance analysis (FBA)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parsimonious-enzyme-usage-fba-pfba">5.2. parsimonious enzyme usage FBA (pFBA)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#flux-variability-analysis">5.3. Flux variability analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../6.Bottleneck_reactions/index.html">6. Bottleneck Reactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7.Limitation_metabolites/index.html">7. Limitation Metabolites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8.Bottleneck_enzymes/index.html">8. Bottleneck Enzymes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../9.Genetic_modification_target/index.html">9. Genetic Modification Target</a></li>
<li class="toctree-l1"><a class="reference internal" href="../10.Solvers/index.html">10. Solvers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ETGEMs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">5. Simulating with FBA</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/5.Simulating_with_FBA/index.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="simulating-with-fba">
<h1>5. Simulating with FBA<a class="headerlink" href="#simulating-with-fba" title="Link to this heading"></a></h1>
<p>This chapter primarily introduces how several of the most common flux analysis algorithms for metabolic network models operate on ETGEMs.</p>
<section id="flux-balance-analysis-fba">
<h2>5.1. Flux balance analysis (FBA)<a class="headerlink" href="#flux-balance-analysis-fba" title="Link to this heading"></a></h2>
<p>First, read the model in JSON format.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">autoETGEMs.io.json</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">read_json_model</span><span class="p">(</span><span class="s2">&quot;./autoETGEMs/model/iML1515_etcmodel_20231108.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Check if the model’s growth medium includes the substrate.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">medium</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;EX_glc__D_e_reverse&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
</pre></div>
</div>
<p>Solutions were obtained for four models separately (GEM: basic metabolic network model, ECM: with enzyme constraints, TCM: with thermodynamic constraints, ETM: with both enzyme and thermodynamic constraints). The default objective function for the models is biomass synthesis reaction.</p>
<p>When calculating models with added thermodynamic constraints, it is necessary to provide a B_value to constrain the minimum thermodynamic driving force of the model. In the example, we set the B_value default to 0.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">autoETGEMs.analysis.flux_balance_analysis</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">opt_gem</span> <span class="o">=</span> <span class="n">calculate_GEM</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="s2">&quot;maximize&quot;</span><span class="p">)</span>
<span class="n">opt_ecm</span> <span class="o">=</span> <span class="n">calculate_ECM</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="s2">&quot;maximize&quot;</span><span class="p">)</span>
<span class="n">opt_tcm</span> <span class="o">=</span> <span class="n">calculate_TCM</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="s2">&quot;maximize&quot;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">opt_etm</span> <span class="o">=</span> <span class="n">calculate_ETM</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="s2">&quot;maximize&quot;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
</pre></div>
</div>
<p>To view the flux value of the objective function, use opt.obj().</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gem_obj_flux: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt_gem</span><span class="o">.</span><span class="n">obj</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ecm_obj_flux: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt_ecm</span><span class="o">.</span><span class="n">obj</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tcm_obj_flux: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt_tcm</span><span class="o">.</span><span class="n">obj</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;etm_obj_flux: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt_etm</span><span class="o">.</span><span class="n">obj</span><span class="p">()))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gem_obj_flux</span><span class="p">:</span> <span class="mf">0.876996163704355</span>
<span class="n">ecm_obj_flux</span><span class="p">:</span> <span class="mf">0.6772977358819029</span>
<span class="n">tcm_obj_flux</span><span class="p">:</span> <span class="mf">0.872879761713119</span>
<span class="n">etm_obj_flux</span><span class="p">:</span> <span class="mf">0.6608464145195769</span>
</pre></div>
</div>
<p>If you want to view the flux value of a specific reaction, the example code would be as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opt_gem</span><span class="o">.</span><span class="n">reaction</span><span class="p">[</span><span class="s2">&quot;PDH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">9.689659737887645</span>
</pre></div>
</div>
<p>If you want to check the concentration value (in ln form) of a specific metabolite in a model with added thermodynamic constraints, the code is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opt_tcm</span><span class="o">.</span><span class="n">metabolite</span><span class="p">[</span><span class="s2">&quot;atp_c&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="mf">12.206072647005957</span>
</pre></div>
</div>
<p>If you want to optimize the maximum production rate of a simulated product, you need to first use the add_demand_reaction() function to add a demand reaction for the target product.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">add_demand_reaction</span><span class="p">(</span><span class="s2">&quot;arg__L_c&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Replace model.obj_name with the added demand reaction, and the reaction name is ‘DM_’ + the ID of the target product.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">obj_name</span> <span class="o">=</span> <span class="s2">&quot;DM_arg__L_c&quot;</span>
</pre></div>
</div>
<p>Solve using the four models.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opt_gem</span> <span class="o">=</span> <span class="n">calculate_GEM</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="s2">&quot;maximize&quot;</span><span class="p">)</span>
<span class="n">opt_ecm</span> <span class="o">=</span> <span class="n">calculate_ECM</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="s2">&quot;maximize&quot;</span><span class="p">)</span>
<span class="n">opt_tcm</span> <span class="o">=</span> <span class="n">calculate_TCM</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="s2">&quot;maximize&quot;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">opt_etm</span> <span class="o">=</span> <span class="n">calculate_ETM</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="s2">&quot;maximize&quot;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gem_arg_yield: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt_gem</span><span class="o">.</span><span class="n">obj</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ecm_arg_yield: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt_ecm</span><span class="o">.</span><span class="n">obj</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tcm_arg_yield: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt_tcm</span><span class="o">.</span><span class="n">obj</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;etm_arg_yield: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt_etm</span><span class="o">.</span><span class="n">obj</span><span class="p">()))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gem_arg_yield</span><span class="p">:</span> <span class="mf">8.340480000007807</span>
<span class="n">ecm_arg_yield</span><span class="p">:</span> <span class="mf">7.607841176597471</span>
<span class="n">tcm_arg_yield</span><span class="p">:</span> <span class="mf">7.822809917363128</span>
<span class="n">etm_arg_yield</span><span class="p">:</span> <span class="mf">5.438335308720897</span>
</pre></div>
</div>
</section>
<section id="parsimonious-enzyme-usage-fba-pfba">
<h2>5.2. parsimonious enzyme usage FBA (pFBA)<a class="headerlink" href="#parsimonious-enzyme-usage-fba-pfba" title="Link to this heading"></a></h2>
<p>ETGEMs also support pFBA. Here, we take the calculation of the basic metabolic network model as an example.</p>
<p>Perform pFBA calculation using Min_Flux_Sum_Calculation(). In the parameters, besides specifying the model file, you also need to provide the model type, the target flux value for FBA, and the name of the target reaction.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">min_v</span><span class="p">,</span> <span class="n">ConcreteModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Min_Flux_Sum_Calculation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="s2">&quot;GEM&quot;</span><span class="p">,</span><span class="mf">8.340480000007807</span><span class="p">,</span><span class="s2">&quot;DM_arg__L_c&quot;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">opt_gem_pfba</span> <span class="o">=</span> <span class="n">Model_Solve</span><span class="p">(</span><span class="n">ConcreteModel</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">solver</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;minimum flux sum : &quot;</span><span class="p">,</span> <span class="n">min_v</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;arg field by pFBA : &quot;</span><span class="p">,</span> <span class="n">opt_gem_pfba</span><span class="o">.</span><span class="n">reaction</span><span class="p">[</span><span class="s2">&quot;DM_arg__L_c&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">minimum</span> <span class="n">flux</span> <span class="nb">sum</span> <span class="p">:</span>  <span class="mf">867.8473600009307</span>
<span class="n">arg</span> <span class="n">field</span> <span class="n">by</span> <span class="n">pFBA</span> <span class="p">:</span>  <span class="mf">8.340480000007807</span>
</pre></div>
</div>
</section>
<section id="flux-variability-analysis">
<h2>5.3. Flux variability analysis<a class="headerlink" href="#flux-variability-analysis" title="Link to this heading"></a></h2>
<p>ETGEMs supports Flux Variability Analysis (FVA), using the basic metabolic network model to simulate growth as an example.</p>
<p>Change model.obj_name to the biomass synthesis reaction.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">obj_name</span> <span class="o">=</span> <span class="s2">&quot;BIOMASS_Ec_iML1515_core_75p37M&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opt_gem</span> <span class="o">=</span> <span class="n">calculate_GEM</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="s2">&quot;maximize&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opt_gem</span><span class="o">.</span><span class="n">obj</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.8769961637043371</span>
</pre></div>
</div>
<p>To perform analysis using the flux_variability_analysis() function, parameters such as the model object, model type, target reaction flux value, target reaction name, etc., need to be provided. Additionally, fraction_of_optimum is a value less than 1. In the example, setting it to 0.95 signifies that the flux variability analysis is conducted for all reactions when the target reaction flux value is above 95% of the optimum</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">autoETGEMs.analysis.flux_variability_analysis</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1"># 通量可变性分析</span>
<span class="n">fva_gem</span> <span class="o">=</span> <span class="n">flux_variability_analysis</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="s2">&quot;GEM&quot;</span><span class="p">,</span> <span class="n">obj_value</span><span class="o">=</span><span class="n">opt_gem</span><span class="o">.</span><span class="n">obj</span><span class="p">(),</span> 
                                    <span class="n">fraction_of_optimum</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">B_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">biomass_id</span><span class="o">=</span><span class="s2">&quot;BIOMASS_Ec_iML1515_core_75p37M&quot;</span><span class="p">,</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fva_gem</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">dataframe</span> <span class="n">tbody</span> <span class="n">tr</span> <span class="n">th</span> <span class="p">{</span>
    <span class="n">vertical</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">top</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">.</span><span class="n">dataframe</span> <span class="n">thead</span> <span class="n">th</span> <span class="p">{</span>
    <span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">right</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>maximize</th>
      <th>minimize</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>DHORD5</th>
      <td>1.065904</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>GLYCTO2</th>
      <td>15.542667</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>GTHOr</th>
      <td>1000.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>G3PD5_num1</th>
      <td>11.657000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>TRPS2</th>
      <td>7.982256</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4ABZGLUtex_reverse_num3</th>
      <td>1000.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>AI2tex_reverse_num4</th>
      <td>1000.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>METGLCURtex_reverse_num2</th>
      <td>1000.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>AI2tex_reverse_num2</th>
      <td>1000.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>AI2tex_reverse_num3</th>
      <td>1000.000000</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>5918 rows × 2 columns</p>
</div></section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../4.Reading_correcting_and_write_model/index.html" class="btn btn-neutral float-left" title="4. Reading, Correcting, and Writing Models." accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../6.Bottleneck_reactions/index.html" class="btn btn-neutral float-right" title="6. Bottleneck Reactions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, zhao jianxiao.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>